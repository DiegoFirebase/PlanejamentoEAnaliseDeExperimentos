---
title: "Estudo de Caso 02: Avaliação e comparação do retorno médio de ações"
author: "Diego Pontes, Elias Vieira, Matheus Bitarães"
date: "Fevereiro, 2021"
output:
    pdf_document:
    fig_caption: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, include=FALSE}

# Importação das bibliotecas (descomentar caso não tenha instalado)
# install.packages("ggplot2")

# Importação de bibliotecas
library(ggplot2)
library(dplyr)
library(car)

```

## Descrição do problema


## Introdução


## Design do Experimento

Os dados de entrada do experimento são as informações de preços de fechamento mensais de 5 ações diferentes, onde cada coluna representa uma ação e cada linha representa um mes de fechamento. 
O que se deseja é comparar o potencial de cada ação em gerar maior ganho mensal ao investidor. Como modelos regressivos de previsão não são o escopo deste trabalho, pode-se realizar uma transformação nestes dados, de forma que haja um vetor com as flutuações percentuais das ações em cada mês. Por exemplo, se houver uma ação com preços de fechamento $[10, 11, 12, 10]$, pode-se gerar o seguinte vetor de flutuações percentuais: $[10\%, 9\%, -16\%]$.

Desta forma, é possivel realizar uma análise estatistica entre as 5 ações e identificar a que apresenta maior incidencia de flutuação positiva, o que será considerado como a ação de maior potencial para gerar retornos.

## Análise Estatística


### Importação dos dados

Os dados das ações foram importados do arquivo *DadosAcoesGrupoC.csv*. 

```{r, include=TRUE, echo=TRUE}

# importação dos dados
data <- read.csv(file = 'DadosAcoesGrupoC.csv', header = FALSE)
colnames(data) <- c("A1","A2","A3","A4","A5") # Adicionando nomes às colunas

# plot dos primeiros 6 dados da tabela
head(data)
```

Cada coluna representa uma ação e cada linha representa o preço de fechamento das ações no mes anterior. Portanto, a linha 1 indica o preço de fechamento do mes atual - 1, a linha 2 representa o mes atual - 2, e assim sucessivamente.

```{r, include=TRUE, echo=TRUE}
theme_set(theme_minimal())

# Plot
plot_a1 <- ggplot(data=data, aes(x=nrow(data):1, y=A1)) + geom_line() + 
  labs(title = "Progressão da Ação 1", x = "Tempo (meses)", y = "Preço de fechamento das ações")
plot_a2 <- ggplot(data=data, aes(x=nrow(data):1, y=A2)) + geom_line() + 
  labs(title = "Progressão da Ação 2", x = "Tempo (meses)", y = "Preço de fechamento das ações")
plot_a3 <- ggplot(data=data, aes(x=nrow(data):1, y=A3)) + geom_line() + 
  labs(title = "Progressão da Ação 3", x = "Tempo (meses)", y = "Preço de fechamento das ações")
plot_a4 <- ggplot(data=data, aes(x=nrow(data):1, y=A4)) + geom_line() + 
  labs(title = "Progressão da Ação 4", x = "Tempo (meses)", y = "Preço de fechamento das ações")
plot_a5 <- ggplot(data=data, aes(x=nrow(data):1, y=A5)) + geom_line() + 
  labs(title = "Progressão da Ação 5", x = "Tempo (meses)", y = "Preço de fechamento das ações")

plot_a1
plot_a2
plot_a3
plot_a4
plot_a5
```

### Tratamento  dos dados

Os dados brutos serão transformados em flutuações percentuais para que se possa realizar a análise estatística.
```{r, include=TRUE, echo=TRUE}

# Transforma dados em porcentagens
data_perc <- data
for(i in (nrow(data)-1):1){
        data_perc[i,] <- 100*( (data[i,] - data[i+1,])/data[i+1,] ) # porcentagem de mudança do fechamento do mes i + 1 em relação ao mes i.
}

data_perc <- data_perc[-c(36), ] # removendo ultima linha

# Criando uma variável para cada amostra
data_a1 <- data_perc$A1
data_a2 <- data_perc$A2
data_a3 <- data_perc$A3
data_a4 <- data_perc$A4
data_a5 <- data_perc$A5
head(data_perc)
```

**algum comentario aqui**

```{r, include=TRUE}
# boxplot
boxplot(data_a1, data_a2, data_a3, data_a4, data_a5,
main = "Boxplots das flutuações percentuais",
at = c(1,2,3,4,5),
names = c("Ação 1", "Ação 2", "Ação 3", "Ação 4", "Ação 5"),
las = 2,
horizontal = TRUE,
notch = FALSE
)
```
**algum comentario sobre o boxplot**

### Dados estatísticos

O teste escolhido foi o ANOVA......[elaborar]


#### Premissas do teste

Para a realização do teste ANOVA, é necessário que as seguintes premissas sejam cumpridas: As amostras devem ser independentes, as amostras devem apresentar distribuição normal e as variâncias podem ser consideradas iguais (homocedasticidade).

[falar sobre independencia das amostras]

Para verificação de normalidade, pode-se realizar o teste de Shapiro-Wilk.
```{r, include=TRUE}
library(car)

apply(data_perc, 2, shapiro.test)
```
Como interpretação do teste, temos que se o p-valor < 0.05 ($\alpha$), deve-se rejeitar a hipótese nula, ou seja, os dados não possuem distribuição normal \cite{teste_norm_R}, caso contrário, não há evidências para se rejeitar a hipótese nula. Portanto, analisando os resultados dos testes dispostos acima, podemos considerar que as amostras de todas as flutuações percentuais das ações seguem distribuição normal


Para a verificação de homocedasticidade entre dois ou mais grupos de amostras, pode-se utilizar o teste de Bartlett [Explicar mais sobre o teste de Bartlett]

```{r, include=TRUE}
# teste de Bartlett
y <- c(data_a1, data_a2, data_a3, data_a4, data_a5)
group <- as.factor(c(rep(1, length(data_a1)), rep(2, length(data_a2)), 
                     rep(3, length(data_a3)), rep(4, length(data_a4)), rep(5, length(data_a5))))
bartlett.test(y, group)


# backup do teste de levene
# y <- c(data_a1, data_a2, data_a3, data_a4, data_a5)
# group <- as.factor(c(rep(1, length(data_a1)), rep(2, length(data_a2)), 
#                     rep(3, length(data_a3)), rep(4, length(data_a4)), rep(5, length(data_a5))))
# leveneTest(y, group)
```
Como interpretação do teste, temos que se o p-valor < 0.05 ($\alpha$), deve-se rejeitar a hipótese nula, ou seja, os grupos de amotras não possuem equivalencia de variâncias, caso contrário, não há evidências para se rejeitar a hipótese nula. Portanto, analisando os resultados dos testes dispostos acima, podemos considerar que as variâncias 


**comparação entre as ações aqui**



## Discussão e Conclusão


### Atividades dos membros

**Diego**


**Elias**


**Matheus**


**Todos**

Elaboração das hipóteses e definição das premissas.


\renewcommand\refname{Referências Bibliográficas}
\bibliographystyle{unsrt}
\bibliography{referencias}

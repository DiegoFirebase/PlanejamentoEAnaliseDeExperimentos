---
title: "Estudo de Caso 02: Avaliação e comparação do retorno médio de ações"
author: "Diego Pontes, Elias Vieira, Matheus Bitarães"
date: "Fevereiro, 2021"
output:
    pdf_document:
    fig_caption: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, include=FALSE}

# Importação das bibliotecas (descomentar caso não tenha instalado)
# install.packages(c("ggplot2", "AICcmodavg"))
# install.packages("gridExtra")
# install.packages("agricolae")

# Importação de bibliotecas
library(ggplot2)
library(gridExtra)
library(dplyr)
library(car)

```

## Descrição do problema

## Introdução


## Design do Experimento

Os dados de entrada do experimento são as informações de preços de fechamento mensais de 5 ações diferentes, onde cada coluna representa uma ação e cada linha representa um mes de fechamento. 
O que se deseja é comparar o potencial de cada ação em gerar maior ganho mensal ao investidor. Como modelos regressivos de previsão não são o escopo deste trabalho, pode-se realizar uma transformação nestes dados, de forma que haja um vetor com as flutuações percentuais das ações em cada mês. Por exemplo, se houver uma ação com preços de fechamento $[10, 11, 12, 10]$, pode-se gerar o seguinte vetor de flutuações percentuais: $[10\%, 9\%, -16\%]$.

Desta forma, é possivel realizar uma análise estatistica entre as 5 ações e identificar a que apresenta maior incidencia de flutuação positiva, o que será considerado como a ação de maior potencial para gerar retornos.

## Análise Estatística


### Importação dos dados

Os dados das ações foram importados do arquivo *DadosAcoesGrupoC.csv*. 

```{r, include=TRUE, echo=TRUE}

# importação dos dados
data <- read.csv(file = 'DadosAcoesGrupoC.csv', header = FALSE)
colnames(data) <- c("A1","A2","A3","A4","A5") # Adicionando nomes às colunas

# plot dos primeiros 6 dados da tabela
head(data)
```

Cada coluna representa uma ação e cada linha representa o preço de fechamento das ações no mes anterior. Portanto, a linha 1 indica o preço de fechamento do mes atual - 1, a linha 2 representa o mes atual - 2, e assim sucessivamente.

```{r, include=TRUE, echo=TRUE}
theme_set(theme_minimal())

# Plot
plot_a1 <- ggplot(data=data, aes(x=nrow(data):1, y=A1)) + geom_line() + 
  labs(title = "Ação 1", x = "Tempo (meses)", y = "$ fechamento") + ylim(10, 35)
plot_a2 <- ggplot(data=data, aes(x=nrow(data):1, y=A2)) + geom_line() + 
  labs(title = "Ação 2", x = "Tempo (meses)", y = "$ fechamento") + ylim(10, 35)
plot_a3 <- ggplot(data=data, aes(x=nrow(data):1, y=A3)) + geom_line() + 
  labs(title = "Ação 3", x = "Tempo (meses)", y = "$ fechamento") + ylim(10, 35)
plot_a4 <- ggplot(data=data, aes(x=nrow(data):1, y=A4)) + geom_line() + 
  labs(title = "Ação 4", x = "Tempo (meses)", y = "$ fechamento") + ylim(10, 35)
plot_a5 <- ggplot(data=data, aes(x=nrow(data):1, y=A5)) + geom_line() + 
  labs(title = "Ação 5", x = "Tempo (meses)", y = "$ fechamento") + ylim(10, 35)

grid.arrange(plot_a1, plot_a2, plot_a3, plot_a4, plot_a5, nrow = 3)
```

### Tratamento  dos dados

Os dados brutos serão transformados em flutuações percentuais para que se possa realizar a análise estatística.
```{r, include=TRUE, echo=TRUE}

# Transforma dados em porcentagens
data_perc <- data
for(i in (nrow(data)-1):1){
        data_perc[i,] <- 100*( (data[i,] - data[i+1,])/data[i+1,] ) 
        # porcentagem de mudança do fechamento do mes i + 1 em relação ao mes i.
}

data_perc <- data_perc[-c(36), ] # removendo ultima linha

# Criando uma variável para cada amostra
data_a1 <- data_perc$A1
data_a2 <- data_perc$A2
data_a3 <- data_perc$A3
data_a4 <- data_perc$A4
data_a5 <- data_perc$A5
head(data_perc)
```

**algum comentario aqui**

```{r, include=TRUE}
# boxplot
boxplot(data_a1, data_a2, data_a3, data_a4, data_a5,
main = "Boxplots das flutuações percentuais",
at = c(1,2,3,4,5),
names = c("Ação 1", "Ação 2", "Ação 3", "Ação 4", "Ação 5"),
las = 2,
horizontal = TRUE,
notch = FALSE
)
```
**algum comentario sobre o boxplot**

### Dados estatísticos

O teste escolhido foi o ANOVA......**elaborar**


#### Premissas do teste:
Para a realização do teste ANOVA, é necessário que as seguintes premissas sejam cumpridas: As amostras devem ser independentes, as amostras devem apresentar distribuição normal e as variâncias podem ser consideradas iguais (homocedasticidade).

[falar sobre independencia das amostras]

**Verificação de Normalidade**: Para uma avaliação estatística sobre a validação da hipótese de uma distribuição normal para as amostras, pode-se usar o teste Shapiro-Wilk, onde têm-se as seguintes hipóteses:

$$\begin{cases} H_0: \text{A amostra provém de uma população com distribuição normal}\\H_1: \text{A amostra não provém de uma população com distribuição normal} \end{cases}$$
```{r, include=TRUE}
library(car)
apply(data_perc, 2, shapiro.test)
```
Como interpretação do teste, temos que se o p-valor < 0.05 ($\alpha$), deve-se rejeitar a hipótese nula, ou seja, os dados não possuem distribuição normal \cite{teste_norm_R}, caso contrário, não há evidências para se rejeitar a hipótese nula. Portanto, analisando os resultados dos testes dispostos acima, podemos considerar que as amostras de todas as flutuações percentuais das ações seguem distribuição normal.

**Verificação de homocedasticidade**: Para a verificação de homocedasticidade entre dois ou mais grupos de amostras, pode-se utilizar o teste de Bartlett, , onde têm-se as seguintes hipóteses: [Explicar mais sobre o teste de Bartlett]

$$\begin{cases} H_0: \text{As variâncias dos erros são homogêneas}\\H_1: \text{As variâncias dos erros não são homogêneas} \end{cases}$$

```{r, include=TRUE}
# teste de Bartlett
y <- c(data_a1, data_a2, data_a3, data_a4, data_a5)
group <- as.factor(c(rep(1, length(data_a1)), rep(2, length(data_a2)), 
                     rep(3, length(data_a3)), rep(4, length(data_a4)), rep(5, length(data_a5))))
bartlett.test(y, group)
```
Como interpretação do teste, temos que se o p-valor < 0.05 ($\alpha$), deve-se rejeitar a hipótese nula, ou seja, os grupos de amotras não possuem equivalencia de variâncias. Como o p-valor > 0.05 , não há evidências para se rejeitar a hipótese nula e portanto podemos considerar homocedasticidade entre as amostras.

Outro teste apenas para comprovar...


```{r, include=TRUE}
# teste de Levene
leveneTest(y, group)
```
Como interpretação do teste, temos que se o p-valor < 0.05 ($\alpha$), deve-se rejeitar a hipótese nula, ou seja, as variâncias dos grupos de amotras são homogêneas, caso contrário, não há evidências para se rejeitar a hipótese nula. Portanto, analisando os resultados dos testes dispostos acima, podemos considerar que as variâncias são homogêneas.

Dada a análise e confirmação da normalidade e homocedasticidade dos dados, pode-se aplicar o teste ANOVA, onde têm-se as seguintes hipóteses:

$$\begin{cases} H_0: \text{A média de todas as populações são iguais}\\H_1: \text{A média de todas as populações não são iguais} \end{cases}$$
```{r, include=TRUE}
# teste ANOVA
anova <- aov(y~group)
anova
summary(anova)
```


Como interpretação do teste, temos que se o p-valor < 0.05 ($\alpha$), deve-se rejeitar a hipótese nula, ou seja, as médias dos grupos de amotras são homogêneas, caso contrário, não há evidências para se rejeitar a hipótese nula. Portanto, analisando os resultados dos testes dispostos acima, podemos considerar que as médias dos grupos não iguais. Ou seja, pelo menos uma das amostras tem sua média diferente.
Para dar sequência aos estudos é necessário fazer uma análise por pares para encontrar-se.... *dar explicação*


```{r, include=TRUE}

# teste Tukey
library(agricolae)
data3 = data.frame(y,group) 
model2 <- aov(y~group, data = data3)
#tukey = HSD.test(model2, "group")
tukey = TukeyHSD(x=model2, "group")

tukey
#plot(tukey)
plot(tukey, las=1, col="brown")

#library(MASS)
#data("crabs")
#crabs$groups.4 <- with(crabs, paste(sp,sex,sep = "."))
#crab.aov <- aov(FL ~ groups.4, data = crabs)
#crab.Tukey <- TukeyHSD(crab.aov)
#plot(crab.Tukey)


#Gerar o gráfico
#library(tibble)
#tukey$groups %>% 
#  rownames_to_column(var = "trt") %>% 
#  mutate(trt = reorder(trt, -y, mean)) %>% 
#  ggplot(aes(trt, y)) +
#    geom_col(alpha = 0.8, color = "black") +
#    geom_text(aes(label = groups), vjust = 1.8, size = 9, color = "white") +
#    labs(x = "Ação", y = "Médias") +
#    theme_bw(16)
```

## Discussão e Conclusão


### Atividades dos membros

**Diego**


**Elias**


**Matheus**


**Todos**

Elaboração das hipóteses e definição das premissas.


\renewcommand\refname{Referências Bibliográficas}
\bibliographystyle{unsrt}
\bibliography{referencias}
